# 阶段 1：分析与 Go-Zero 映射 ✅

## MVP 10 核心服务

| # | 服务 | 类型 | HTTP | RPC | 数据库 |
|---|------|------|------|-----|--------|
| 1 | 用户服务 | API+RPC | `/user/*` | `UserRpc` | `db_user` |
| 2 | 认证服务 | API | `/auth/*` | — | 复用 db_user |
| 3 | 商品服务 | API+RPC | `/product/*` | `ProductRpc` | `db_product` |
| 4 | 库存服务 | RPC | — | `InventoryRpc` | `db_inventory` |
| 5 | 搜索服务 | API | `/search/*` | — | Elasticsearch |
| 6 | 购物车 | API+RPC | `/cart/*` | `CartRpc` | `db_cart` |
| 7 | 营销服务 | API+RPC | `/coupon/*` | `PromotionRpc` | `db_promotion` |
| 8 | 订单服务 | API+RPC | `/order/*` | `OrderRpc` | `db_order` |
| 9 | 支付服务 | API | `/payment/*` | — | `db_payment` |
| 10 | 物流服务 | API+RPC | `/logistics/*` | `LogisticsRpc` | `db_logistics` |

## 映射关系

```
文档设计                    go-zero 实现
───────────────────────────────────────────
HTTP 接口        →  .api 文件 (路由+类型)
内部调用         →  .proto 文件 (gRPC)
数据表           →  goctl model (CRUD)
业务逻辑         →  internal/logic/ (手写)
```

## 项目目录结构

```
go-mail/
├── services/            # 微服务 (user/auth/product/...)
│   └── <service>/
│       ├── api/         # HTTP (desc/*.api → goctl 生成)
│       ├── rpc/         # gRPC (*.proto → goctl 生成)
│       └── model/       # 数据库模型
├── common/              # 公共包 (xerr/response/utils)
├── deploy/sql/          # PostgreSQL DDL
└── doc1.0/              # 文档
```

## 开发顺序

```
User+Auth → Product+Inventory → Search → Cart → Promotion → Order → Payment → Logistics
```

## 关键注意事项

| 需求 | Go-Zero 实现 | 常见错误 |
|:---|:---|:---|
| JWT 认证 | `.api` 中 `jwt: Auth` | 漏配 `AccessSecret` |
| 密码加密 | `bcrypt` | 明文存储 |
| 统一响应 | `response.Response()` | 格式不一致 |
| 库存扣减 | Redis Lua 原子操作 | 超卖 |
| 分布式事务 | 本地消息表 + Kafka | 幂等缺失 |
