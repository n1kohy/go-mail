# 阶段 2：项目初始化 ✅

## Go Module

```
module go-mail
go 1.25.0
require github.com/zeromicro/go-zero v1.9.4
```

## PostgreSQL 建表脚本

8 个独立数据库，19 张表，位于 `deploy/sql/`：

| 文件 | 表数 | 特性 |
|:---|:---|:---|
| `db_user.sql` | 2 | `BIGSERIAL`, `BOOLEAN` |
| `db_auth.sql` | 1 | `INET` |
| `db_product.sql` | 3 | `JSONB`, `tsvector` |
| `db_inventory.sql` | 1 | 乐观锁 `version` |
| `db_cart.sql` | 1 | `UNIQUE(user_id, sku_id)` |
| `db_promotion.sql` | 3 | `JSONB` |
| `db_order.sql` | 3 | 雪花 `VARCHAR(64)` 主键 |
| `db_payment.sql` | 1 | `NUMERIC(10,2)` |
| `db_logistics.sql` | 2 | `JSONB` |

```bash
createdb db_user && psql -d db_user -f deploy/sql/db_user.sql
```

## 公共包

```
common/
├── xerr/xerr.go         # 统一错误码 + CodeError 类型
├── response/response.go # 统一响应 {code, msg, data}
└── utils/crypto.go      # bcrypt HashPassword() / CheckPassword()
```

## Spec-First 代码生成

### Spec 定义文件

| 文件 | 接口数 |
|:---|:---|
| `services/user/api/desc/user.api` | 4 (Register/Info/AddAddress/AddressList) |
| `services/auth/api/desc/auth.api` | 3 (Login/Refresh/Logout) |
| `services/user/rpc/user.proto` | 3 (GetUser/GetByMobile/GetByUsername) |

### goctl 生成命令

```bash
# API
goctl api go -api desc/user.api -dir . -style gozero

# RPC
goctl rpc protoc user.proto --go_out=. --go-grpc_out=. --zrpc_out=. -style gozero
```

goctl 自动生成 **40 个文件**（handler/routes/types/server/config/svc/main）,按 `@server(group)` 分组到子目录。

### 已完成服务

| 服务 | API | RPC | Model | 状态 |
|:---|:---|:---|:---|:---|
| **User** | 4 接口 (1 公开 + 3 JWT) | 3 方法 | user + user_address | ✅ |
| **Auth** | 3 接口 (2 公开 + 1 JWT) | — | 复用 User Model | ✅ |

```bash
go build ./...  # ✅ 通过
```
